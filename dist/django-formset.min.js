/*! Django Formset - v0.1.0 - 2014-02-24
* https://github.com/mbertheau/jquery.django-formset
* Copyright (c) 2014 Markus Bertheau; Licensed MIT */
var FormsetError,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},__bind=function(a,b){return function(){return a.apply(b,arguments)}};FormsetError=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b}(Error),function(a){a.fn.djangoFormset=function(b){return new a.fn.djangoFormset.Formset(this,b)},a.fn.djangoFormset.Formset=function(){function b(b,c){var d,e;if(e=a.extend({},a.fn.djangoFormset.default_options,c),this.prefix=e.prefix,0===b.length)throw new FormsetError("Empty selector.");if(this.totalForms=b.find("#id_"+this.prefix+"-TOTAL_FORMS"),0===this.totalForms.length)throw new FormsetError("Management form field 'TOTAL_FORMS' not found for prefix "+this.prefix+".");if("TABLE"===b.prop("tagName")&&(b=b.children("tbody")),this.template=b.children(".empty-form"),0===this.template.length)throw new FormsetError("Can't find template (looking for .empty-form)");d=b.children().not(".empty-form"),this.forms=function(c){return function(){var d,e,f,g,h;for(g=b.children(":visible"),h=[],e=0,f=g.length;f>e;e++)d=g[e],h.push(new a.fn.djangoFormset.Form(d,c));return h}}(this)(),this.insertAnchor=b.children().last()}return b.prototype.addForm=function(){var b,c;c=this.template.clone().removeClass("empty-form"),b=new a.fn.djangoFormset.Form(c,this),b.initFormIndex(this.totalForms.val()),this.totalForms.val(parseInt(this.totalForms.val())+1),c.insertAfter(this.insertAnchor),this.insertAnchor=c,this.forms.push(b)},b.prototype.deleteForm=function(a){var b;b=this.forms[a],b["delete"](),this.forms.splice(a,1),this._renumberFormIndexes()},b.prototype._renumberFormIndexes=function(){var a,b,c,d,e,f;for(e=this.forms,f=[],b=c=0,d=e.length;d>c;b=++c)a=e[b],f.push(a.updateFormIndex(b));return f},b}(),a.fn.djangoFormset.Form=function(){function b(a,b){this.elem=a,this.formset=b,this["delete"]=__bind(this["delete"],this)}return b.prototype["delete"]=function(){var a,b,c;b="#{@formset.prefix}-#{index}-DELETE",a=this.elem.find("input:hidden[name='"+b+"']").get(0),c=null!=a,c?this._deleteInitial():this._deleteNew()},b.prototype._deleteNew=function(){return this.elem.remove(),this.formset.totalForms.val(parseInt(this.formset.totalForms.val())-1)},b.prototype._replaceFormIndex=function(b,c){var d,e;return e=new RegExp("^(id_)?"+this.formset.prefix+"-"+b),d=""+this.formset.prefix+"-"+c,this.elem.find("input,select,textarea,label").each(function(){var b,c,f,g,h;for(c=a(this),h=["for","id"],f=0,g=h.length;g>f;f++)b=h[f],c.attr(b)&&c.attr(b,c.attr(b).replace(e,"id_"+d));c.attr("name")&&c.attr("name",c.attr("name").replace(e,d))})},b.prototype.initFormIndex=function(a){return this._replaceFormIndex("__prefix__",a)},b.prototype.updateFormIndex=function(a){return this._replaceFormIndex("\\d+",a)},b}(),a.fn.djangoFormset.default_options={prefix:"form"}}(jQuery);