/*! Django Formset - v0.1.0 - 2014-02-26
* https://github.com/mbertheau/jquery.django-formset
* Copyright (c) 2014 Markus Bertheau; Licensed MIT */
var FormsetError,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};FormsetError=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b}(Error),function(a){a.fn.djangoFormset=function(b){return new a.fn.djangoFormset.Formset(this,b)},a.fn.djangoFormset.Formset=function(){function b(b){var c,d;if(0===b.length)throw new FormsetError("Empty selector.");if(this.template=b.filter(".empty-form"),0===this.template.length)throw new FormsetError("Can't find template (looking for .empty-form)");if(c=this.template.find("input,select,textarea").first().attr("name"),!c)throw new FormsetError("Can't figure out form prefix because there's no form element in the form template. Please add one.");if(d=c.indexOf("-__prefix__"),-1===d)throw new FormsetError("Can't figure out form prefix from template because it doesn't contain '-__prefix__'.");if(this.prefix=c.substring(0,d),this.totalForms=a("#id_"+this.prefix+"-TOTAL_FORMS"),0===this.totalForms.length)throw new FormsetError("Management form field 'TOTAL_FORMS' not found for prefix "+this.prefix+".");if(this.initialForms=a("#id_"+this.prefix+"-INITIAL_FORMS"),0===this.initialForms.length)throw new FormsetError("Management form field 'INITIAL_FORMS' not found for prefix "+this.prefix+".");this.forms=b.filter(":visible").map(function(b){return function(c,d){return new a.fn.djangoFormset.Form(a(d),b,c)}}(this)),this.forms.length!==parseInt(this.totalForms.val())&&console.error("TOTAL_FORMS is "+this.totalForms.val()+", but "+this.forms.length+" visible children found."),this.insertAnchor=b.filter(":visible").last(),0===this.insertAnchor.length&&(this.insertAnchor=this.template)}return b.prototype.addForm=function(){var b,c;return c=this.template.clone().removeClass("empty-form"),b=new a.fn.djangoFormset.Form(c,this,this.totalForms.val()),this.totalForms.val(parseInt(this.totalForms.val())+1),c.insertAfter(this.insertAnchor),this.insertAnchor=c,this.forms.push(b),a(this).trigger("formAdded",[b]),b},b.prototype.deleteForm=function(a){var b;b=this.forms[a],b["delete"]()},b.prototype.handleFormRemoved=function(a){var b,c,d,e,f;for(this.totalForms.val(parseInt(this.totalForms.val())-1),this.forms.splice(a,1),f=this.forms,c=d=0,e=f.length;e>d;c=++d)b=f[c],b._updateFormIndex(c);this.insertAnchor=0===this.forms.length?this.template:this.forms[this.forms.length-1].elem},b}(),a.fn.djangoFormset.Form=function(){function b(a,b,c){var d;this.elem=a,this.formset=b,this.index=c,void 0!==this.index&&this._initFormIndex(this.index),d=""+this.formset.prefix+"-"+this.index+"-DELETE",this.deleteInput=this.elem.find("input[name='"+d+"']"),this._hideDeleteCheckbox(),this._addDeleteButton()}return b.prototype.getDeleteButton=function(){return a('<button type="button" class="btn btn-danger"> Delete </button>')},b.prototype.getDeleteButtonContainer=function(){return this.elem.is("TR")?this.elem.children().last():this.elem.is("UL")||this.elem.is("OL")?this.elem.append("li").children().last():this.elem},b.prototype["delete"]=function(){var a;a=this.index<parseInt(this.formset.initialForms.val()),a?(this.deleteInput.val("on"),this.hide()):(this.elem.remove(),this.formset.handleFormRemoved(this.index))},b.prototype.hide=function(){return this.elem.hide()},b.prototype._hideDeleteCheckbox=function(){var a;return this.deleteInput.before("<input type='hidden' name='"+this.deleteInput.attr("name")+"' id='"+this.deleteInput.attr("id")+"' value='"+this.deleteInput.val()+"'/>"),a=this.deleteInput.prev(),this.elem.find("label[for='"+this.deleteInput.attr("id")+"']").remove(),this.deleteInput.remove(),this.deleteInput=a},b.prototype._addDeleteButton=function(){return this.deleteButton=this.getDeleteButton(),this.getDeleteButtonContainer().append(this.deleteButton),this.deleteButton.on("click",function(a){return function(){return a["delete"]()}}(this))},b.prototype._replaceFormIndex=function(b,c){var d,e;this.index=c,e=new RegExp("^(id_)?"+this.formset.prefix+"-"+b),d=""+this.formset.prefix+"-"+c,this.elem.find("input,select,textarea,label").each(function(){var b,c,f,g,h;for(c=a(this),h=["for","id"],f=0,g=h.length;g>f;f++)b=h[f],c.attr(b)&&c.attr(b,c.attr(b).replace(e,"id_"+d));c.attr("name")&&c.attr("name",c.attr("name").replace(e,d))})},b.prototype._initFormIndex=function(a){this._replaceFormIndex("__prefix__",a)},b.prototype._updateFormIndex=function(a){this._replaceFormIndex("\\d+",a)},b}()}(jQuery);